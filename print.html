<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>wgslsmith</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="././mdbook-admonish.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="building/index.html"><strong aria-hidden="true">2.</strong> Building</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="building/cross-compiling.html"><strong aria-hidden="true">2.1.</strong> Cross-compiling</a></li></ol></li><li class="chapter-item expanded "><a href="generator/index.html"><strong aria-hidden="true">3.</strong> Generator</a></li><li class="chapter-item expanded "><a href="reconditioner/index.html"><strong aria-hidden="true">4.</strong> Reconditioner</a></li><li class="chapter-item expanded "><a href="harness/index.html"><strong aria-hidden="true">5.</strong> Harness</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="harness/usage.html"><strong aria-hidden="true">5.1.</strong> Basic usage</a></li><li class="chapter-item expanded "><a href="harness/configurations.html"><strong aria-hidden="true">5.2.</strong> Configurations</a></li><li class="chapter-item expanded "><a href="harness/exit-codes.html"><strong aria-hidden="true">5.3.</strong> Exit codes</a></li></ol></li><li class="chapter-item expanded "><a href="validator/index.html"><strong aria-hidden="true">6.</strong> Validation Server</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">wgslsmith</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/wgslsmith/wgslsmith" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="wgslsmith"><a class="header" href="#wgslsmith">wgslsmith</a></h1>
<p><a href="https://github.com/wgslsmith/wgslsmith/actions/workflows/ci.yml"><img src="https://github.com/wgslsmith/wgslsmith/actions/workflows/ci.yml/badge.svg" alt="CI" /></a>
<a href="https://wgslsmith.github.io"><img src="https://img.shields.io/badge/docs-wgslsmith.github.io-orange" alt="" /></a></p>
<p><code>wgslsmith</code> is a program generator capable of producing random <a href="https://www.w3.org/TR/WGSL/">WGSL</a> shaders, primarily for fuzzing WGSL compilers. This repository contains the wgslsmith generator source code, as well as tools for testing WGSL/WebGPU implementations.</p>
<p>Currently, the compilers that are supported for testing include <a href="https://github.com/gfx-rs/naga">naga</a> via <a href="https://github.com/gfx-rs/wgpu">wgpu</a> and <a href="https://dawn.googlesource.com/tint">tint</a> via <a href="https://dawn.googlesource.com/dawn">dawn</a>.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li><a href="https://rustup.rs/">Rust</a></li>
</ul>
<p>A more complete list of requirements is available <a href="https://wgslsmith.github.io/building/index.html">here</a>.</p>
<h2 id="building"><a class="header" href="#building">Building</a></h2>
<p>The full set of tools requires compiling Dawn and wgpu. Full instructions can be found in the <a href="https://wgslsmith.github.io/building/index.html">docs</a>.</p>
<p>Alternatively, some of the tools can be used without any WebGPU implementations/compilers (e.g. generator and reconditioner). To compile these, run:</p>
<pre><code class="language-sh">$ git clone --recursive https://github.com/wgslsmith/wgslsmith
$ cd wgslsmith
$ cargo build -p wgslsmith --release
$ target/release/wgslsmith --help
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>All the tools can be used through the <code>wgslsmith</code> command:</p>
<pre><code class="language-sh"># Do some fuzzing
$ wgslsmith fuzz
# Recondition a shader
$ wgslsmith recondition /path/to/shader.wgsl
# Reduce a crash
$ wgslsmith reduce crash path/to/shader.wgsl --config wgpu:dx12:9348 --regex '...'
# Run a shader
$ wgslsmith run path/to/shader.wgsl
</code></pre>
<p>Some options can be configured through a config file. Run <code>wgslsmith config</code> to open the default config file in a text editor. You can also specify a custom config file with the <code>--config-file</code> option.</p>
<pre><code class="language-toml">[reducer]
tmpdir = &quot;/home/hasan/dev/wgslsmith/tmp&quot;
parallelism = 24

[reducer.creduce]
path = &quot;/optional/path/to/creduce&quot;

[reducer.cvise]
path = &quot;/optional/path/to/cvise&quot;

[reducer.perses]
# You need this if you want to reduce with perses
jar = &quot;/path/to/perses_deploy.jar&quot;
</code></pre>
<p>To use perses for reduction, grab and build it from https://github.com/wgslsmith/perses, then add it to the config as above.</p>
<h2 id="development"><a class="header" href="#development">Development</a></h2>
<p><a href="https://github.com/mitsuhiko/insta">Insta</a> is used for snapshot testing the parser.</p>
<p>Install the tool with <code>cargo install cargo-insta</code> and use <code>cargo insta test -p parser</code> to run the parser tests.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-wgslsmith"><a class="header" href="#building-wgslsmith">Building wgslsmith</a></h1>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="building/index.html#admonition-info"></a></p>
</div>
<div>
<p>Building for Windows is supported by cross compiling from Linux (ideally using <a href="https://docs.microsoft.com/en-us/windows/wsl/">WSL</a>). It shouldn't be too hard to build everything natively on Windows, but you're on your own.</p>
</div>
</div>
<ul>
<li><a href="building/index.html#dawn-prerequisites">Dawn Prerequisites</a>
<ul>
<li><a href="building/index.html#cmake">CMake</a></li>
<li><a href="building/index.html#depot_tools">depot_tools</a></li>
<li><a href="building/index.html#ninja">Ninja</a></li>
<li><a href="building/index.html#linux-dependencies">Linux dependencies</a></li>
</ul>
</li>
<li><a href="building/index.html#windows">Windows</a></li>
<li><a href="building/index.html#building">Building</a></li>
<li><a href="building/index.html#installing">Installing</a></li>
</ul>
<h2 id="dawn-prerequisites"><a class="header" href="#dawn-prerequisites">Dawn Prerequisites</a></h2>
<p>The test harness and program reduction tools depend on <a href="https://dawn.googlesource.com/dawn">dawn</a>, which has a few prerequisites for building. If you don't want to build those tools, you can skip this bit.</p>
<h3 id="cmake"><a class="header" href="#cmake">CMake</a></h3>
<p>If you don't already have it, run the following (for Ubuntu):</p>
<pre><code class="language-sh">$ sudo apt install cmake
</code></pre>
<p>Otherwise, download it from <a href="https://cmake.org/download/">https://cmake.org/download/</a>.</p>
<h3 id="depot_tools"><a class="header" href="#depot_tools">depot_tools</a></h3>
<p>Dawn uses depot_tools to fetch its dependencies. Detailed usage instructions can be found <a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up">here</a>. To install it:</p>
<pre><code class="language-sh"># Clone the depot_tools repo somewhere on your system
$ git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
# Add it to your PATH
$ export PATH=/path/to/depot_tools:$PATH
</code></pre>
<h3 id="ninja"><a class="header" href="#ninja">Ninja</a></h3>
<p>On Ubuntu:</p>
<pre><code class="language-sh">$ sudo apt install ninja-build
</code></pre>
<p>Otherwise, grab the binary from <a href="https://github.com/ninja-build/ninja/releases">https://github.com/ninja-build/ninja/releases</a> and add it your <code>PATH</code>.</p>
<h3 id="linux-dependencies"><a class="header" href="#linux-dependencies">Linux dependencies</a></h3>
<p>If you're building for Linux, you might need a few more dependencies. On Ubuntu, you can install the following packages:</p>
<pre><code class="language-sh">$ sudo apt install libxrandr-dev libxinerama-dev libx11-dev \
    libxcursor-dev libxi-dev libxext-dev libxcb-shm0-dev libxtst-dev \
    libx11-xcb-dev
</code></pre>
<h2 id="windows"><a class="header" href="#windows">Windows</a></h2>
<p>If cross-compiling for Windows, you'll also need to follow the instructions <a href="building/./cross-compiling.html">here</a> to set up the compiler and SDK.</p>
<h2 id="building-1"><a class="header" href="#building-1">Building</a></h2>
<p>Make sure to clone wgslsmith recursively to fetch the submodules:</p>
<pre><code class="language-sh">$ git clone --recursive https://github.com/wgslsmith/wgslsmith
$ cd wgslsmith
</code></pre>
<p>To build everything, run the following:</p>
<pre><code class="language-sh">$ ./build.py
</code></pre>
<p>This will automatically build dawn, and then build wgslsmith.</p>
<p>You can also disable some features if you don't want to build dawn and wgpu:</p>
<pre><code class="language-sh">$ ./build.py --no-reducer --no-harness
</code></pre>
<p>If cross compiling for Windows, you need to set the target explicitly:</p>
<pre><code class="language-sh">$ ./build.py --target x86_64-pc-windows-msvc
</code></pre>
<p>It's possible to build the harness as a standalone tool:</p>
<pre><code class="language-sh">$ ./build.py harness
</code></pre>
<p>Build output will be in <code>target/release</code> (or <code>cross-target/&lt;target&gt;/release</code> when cross compiling).</p>
<h2 id="installing"><a class="header" href="#installing">Installing</a></h2>
<p>To make the <code>wgslsmith</code> command available globally, run the following (after building):</p>
<pre><code class="language-sh">$ ./build.py install [--install-prefix &lt;path&gt;]
</code></pre>
<p>This will create a symlink to <code>target/release/wgslsmith</code>, so you don't need to rerun it every time you rebuild. Use the <code>--install-prefix</code> option to specify the directory to install in (defaults to <code>/usr/local/bin</code>).</p>
<p>Alternatively you can just put the binary somewhere on your <code>PATH</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cross-compiling"><a class="header" href="#cross-compiling">Cross-compiling</a></h1>
<ul>
<li><a href="building/cross-compiling.html#windows">Windows</a></li>
</ul>
<h2 id="windows-1"><a class="header" href="#windows-1">Windows</a></h2>
<p>Windows is supported through cross-compilation using llvm's msvc target.</p>
<p>Add the msvc target to your rust toolchain with rustup:</p>
<pre><code class="language-sh">$ rustup target add x86_64-pc-windows-msvc
</code></pre>
<p>Install the clang and llvm packages (on Ubuntu):</p>
<pre><code class="language-sh">$ sudo apt install clang-12 clang-tools-12 llvm-12
</code></pre>
<p>You'll also need a copy of the Windows SDK headers and libraries. <a href="https://github.com/Jake-Shadle/xwin">xwin</a> is a super handy tool which can be used to download them on Linux. Install it from source or grab a binary from the releases, then run the following:</p>
<pre><code class="language-sh">$ xwin splat --include-debug-libs --cache-dir /path/to/sdk
</code></pre>
<p>The <code>/path/to/sdk</code> can be anywhere on your system where you'd like to download the SDK.</p>
<p>Also, make sure to set these environment variables:</p>
<pre><code class="language-sh"># If you installed llvm on Ubuntu like above, this should be `/usr/lib/llvm-12`
export LLVM_NATIVE_TOOLCHAIN=&quot;/path/to/llvm&quot;
# This should be the path to wherever you downloaded the Windows SDK with xwin
export XWIN_CACHE=&quot;/path/to/sdk&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="generator"><a class="header" href="#generator">Generator</a></h1>
<p>The program generator is able to randomly generate WGSL programs using a range of language features.</p>
<pre><code class="language-sh"># Generate a shader
$ wgslsmith gen
# Show help text
$ wgslsmith gen --help
</code></pre>
<p>Note that programs produced by the generator may not always compile (despite being syntactically valid and well-typed). This is because some WGSL compilers implement additional validation such as rejecting obvious infinite loops. wgslsmith uses a technique called reconditioning (see <a href="generator/../reconditioner/index.html">here</a>) to guarantee validity. You can recondition shaders by passing <code>--recondition</code> to the generator, or by invoking the reconditioner separately on the generated shader which allows more control over its behaviour.</p>
<p>The generator has various options to control the generation process. See the help text for a full list.</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="generator/index.html#admonition-note"></a></p>
</div>
<div>
<p>The options to control the sizes of functions and statement blocks are currently a rough approximation due to how the generator works. This may be fixed in future.</p>
</div>
</div>
<p>Pointers are currently supported as an opt-in feature (since the reconditioner may reject some shaders with invalid pointer operations). To enable them, use the <code>--enable-pointers</code> flag. If reconditioning (with <code>--recondition</code>), you can also pass <code>--skip-pointer-checks</code> to stop it from erroring if the program contains possible invalid pointer operations.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reconditioner"><a class="header" href="#reconditioner">Reconditioner</a></h1>
<p>wgslsmith uses a simple technique called reconditioning to remove certain unwanted behaviour from programs (such as out-of-bounds array accesses and infinite loops). This involves a tool called a reconditioner, which validates and transforms shaders to add safety checks around potentially dangerous operations. The advantage of using a separate tool rather than implementing this in the generator is that it enables using off-the-shelf program reduction tools such as C-Reduce and Perses.</p>
<pre><code class="language-sh"># Recondition a shader
$ wgslsmith recondition path/to/shader.wgsl
</code></pre>
<p>The reconditioner can be used to guarantee loop termination, which is important for making sure that programs can be compiled as some compilers reject obvious infinite loops. If you only want to enforce loop terminate without any other runtime checks, pass <code>--enable loop-limiters</code> to the reconditioner.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="harness"><a class="header" href="#harness">Harness</a></h1>
<p>The test harness is used to run shader programs within a WebGPU pipeline. The harness is flexible and can be used for shaders with different inputs and outputs by providing a JSON description of the shader's I/O interface.</p>
<p>The harness will execute the shaders against multiple WebGPU implementations/configurations and compare the outputs to detect mismatches.</p>
<p>Currently, the harness only supports running compute shaders.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basic-usage"><a class="header" href="#basic-usage">Basic usage</a></h1>
<p>To execute a shader, run:</p>
<pre><code class="language-sh">$ wgslsmith run /path/to/shader.wgsl
</code></pre>
<p>You can also supply input data to initialize any unfiform/storage buffers, by writing a json file of the form:</p>
<pre><code class="language-json">{
  &quot;{group}:{binding}&quot;: [1, 2, 3, ...]
}
</code></pre>
<p>This contains a mapping from the buffer ID to a byte array containing the init data. The values of <code>group</code> and <code>binding</code> should be the corresponding attribute values in the WGSL program:</p>
<pre><pre class="playground"><code class="language-rust">struct Buffer {
    value: u32,
};

@group(0) @binding(0) // &lt;- 0:0
var&lt;uniform&gt; input: Buffer;

@group(0) @binding(1) // &lt;- 0:1
var&lt;storage, read_write&gt; output: Buffer;

@compute
@workgroup_size(1)
fn main() {
    output.value = input.value;
}
</code></pre></pre>
<p>By default, when executing a shader with an explicit path, the harness will look for a json file with the same name and parent directory as the shader. For example, given a shader file at <code>/path/to/shader.wgsl</code>, the harness will look for the inputs file at <code>/path/to/shader.json</code>.</p>
<p>You can also specify the inputs file path explicitly by passing <code>/path/to/inputs.json</code> as the second positional argument on the command line, or even specify the json object inline: <code>'{&quot;0:0&quot;: [...]}'</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configurations"><a class="header" href="#configurations">Configurations</a></h1>
<p>The harness will execute the input shader against one or more configurations, and compare the results of the output buffers for each configuration to detect possible miscompilation bugs.</p>
<p>A configuration is defined as the combination of a WebGPU implementation (such as dawn or wgpu) and a graphics adapter. The graphics adapter is identified by its backend type (D3D12, Metal, Vulkan) and a platform-specific integer identifier for the device.</p>
<p>Use the <code>list</code> subcommand to get a list of available configurations on your machine.</p>
<pre><code class="language-sh">$ wgslsmith harness list
ID             | Adapter Name
---------------+------------------------------
wgpu:vk:9348   | NVIDIA GeForce RTX 3070
wgpu:dx12:9348 | NVIDIA GeForce RTX 3070
wgpu:dx12:140  | Microsoft Basic Render Driver
dawn:dx12:9348 | NVIDIA GeForce RTX 3070
dawn:dx12:140  | Microsoft Basic Render Driver
dawn:vk:9348   | NVIDIA GeForce RTX 3070
</code></pre>
<p>On my machine there are three adapters available, corresponding to hardware Vulkan and D3D12 implementations as well as a D3D12 software implementation. The configuration IDs consist of the WebGPU implementation, the backend type, and the PCI ID for the adapter.</p>
<p>By default, the harness will attempt to find the first available adapter for each combination of WebGPU implementation and backend type. Thus, all configurations above will be selected except for the D3D12 software adapter.</p>
<p>To specify configurations manually, you can pass them on the command line using the <code>-c</code> option.</p>
<pre><code class="language-sh">$ wgslsmith run test.wgsl -c wgpu:dx12:140 -c dawn:dx12:140 -c dawn:vk:9348
executing wgpu:dx12:140
outputs:
  0: [2, 0, 0, 0]

executing dawn:dx12:140
outputs:
  0: [2, 0, 0, 0]

executing dawn:vk:9348
outputs:
  0: [2, 0, 0, 0]

ok
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exit-codes"><a class="header" href="#exit-codes">Exit codes</a></h1>
<p>Test case reduction tools such as <a href="https://embed.cs.utah.edu/creduce/">c-reduce</a> typically take an <em>interestingness</em> test as input, which returns <code>0</code> for a useful test case or <code>1</code> if the test case should be discarded.</p>
<p>The harness can produce two types of errors:</p>
<ul>
<li>If the actual shader execution failed, this will manifest as a panic with exit code <code>101</code>.</li>
<li>If the shader was successfully executed for all configurations but the outputs differ, the program will exit with code <code>1</code>.</li>
</ul>
<p>Otherwise, the program exits normally with code <code>0</code>.</p>
<p>Normally when using this with a reduction tool to find miscompilations, you will want to discard the shader if the harness returns <code>0</code> or <code>101</code>, since execution failure means that the reduction process probably produced an invalid program. Only the exits with <code>1</code> are likely to be interesting.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="validation-server"><a class="header" href="#validation-server">Validation Server</a></h1>
<ul>
<li><a href="validator/index.html#overview">Overview</a></li>
<li><a href="validator/index.html#obtaining-the-compilers">Obtaining the compilers</a>
<ul>
<li><a href="validator/index.html#fxc">FXC</a></li>
<li><a href="validator/index.html#metal">Metal</a></li>
</ul>
</li>
<li><a href="validator/index.html#toolchain-setup">Toolchain setup</a></li>
<li><a href="validator/index.html#usage">Usage</a></li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The FXC and Metal compilers can be used to validate HLSL and MSL shaders. Unfortunately neither of these tools are actually available for Linux, but it's possible to run them using <a href="https://www.winehq.org/">wine</a>.</p>
<p>Running with wine has a startup cost of a few seconds, which can make program reduction significantly slower. We get around this by using a server for validating shaders. This is packaged along with a Wine installation in a docker container.</p>
<h2 id="obtaining-the-compilers"><a class="header" href="#obtaining-the-compilers">Obtaining the compilers</a></h2>
<h3 id="fxc"><a class="header" href="#fxc">FXC</a></h3>
<p>The FXC dll is already included in the <code>tools</code> subdirectory of the wgslsmith repository.</p>
<h3 id="metal"><a class="header" href="#metal">Metal</a></h3>
<p>You can download the Metal Developer Tools for Windows from <a href="https://developer.apple.com/download/all/?q=metal">here</a>. You'll need an Apple ID to get access. Copy the installer to <code>tools/Metal_Developer_Tools.exe</code>.</p>
<h2 id="toolchain-setup"><a class="header" href="#toolchain-setup">Toolchain setup</a></h2>
<p>The validation server needs to be compiled for Windows. Following the instructions <a href="validator/../building/cross-compiling.html#windows">here</a> to setup a cross-compilation environment on Linux.</p>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>Start the validation server using the following command. This will compile the server and then build and start a docker container containing wine and the compiler tools.</p>
<pre><code class="language-sh">$ ./start-validation-server.sh
</code></pre>
<p>The default server port is 9123. Add this to your wgslsmith config file (using the <code>wgslsmith config</code> command).</p>
<pre><code class="language-toml">[validator]
server = &quot;localhost:9123&quot;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
